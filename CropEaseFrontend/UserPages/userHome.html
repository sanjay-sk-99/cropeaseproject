<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crop Ease</title>

  <link rel="stylesheet" href="index.css" />
  <!-- tailwind css -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome Icons-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            animation: {
              'pulse-border': 'pulseBorder 2s infinite',
            },
            keyframes: {
              pulseBorder: {
                '0%, 100%': { borderColor: '#22c55e' }, // green-500
                '50%': { borderColor: '#bbf7d0' },      // green-200
              }
            }
          }
        }
      }
    </script>
  
</head>

<body>
  <!-- NAVBAR -->
  <nav class="bg-green-600 p-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-white text-2xl font-bold">CropEase</h1>
      <!-- Dark overlay (initially hidden) -->
      <div id="overlay"
        class="fixed inset-0 bg-black bg-opacity-50 hidden md:hidden z-40 transition-opacity duration-300"></div>
      <!-- Sidebar Menu (Mobile Only) -->
      <div id="mobileMenu"
        class="fixed top-0 left-0 h-full w-64 bg-green-600 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden shadow-lg p-6 z-50">
        <button id="closeMenu" class="text-white text-2xl absolute top-4 right-4">
          ✖
        </button>
        <nav class="flex flex-col gap-6 mt-10">
          <a href="aboutus.html" class="nav-link text-white font-semibold text-xl transition">About Us</a>
         

      

          <a href="./userOrderPage.html" class="nav-link text-white font-semibold text-xl transition">my order
          </a>

          <!-- <button id="logoutBtn" class="text-white bg-red-500 hover:bg-red-600 px-4 py-1 rounded hidden md:block">
            Logout
          </button> -->
        </nav>
      </div>
      <!-- Desktop Nav -->
      <div class="md:flex flex-col md:flex-row hidden md:items-center gap-6 mt-4 md:mt-0">
        <a href="./userAboutPage.html" class="nav-link text-white font-semibold text-xl transition">About Us</a>
       

        

        <a href="./userOrderPage.html" class="nav-link text-white font-semibold text-xl transition">my order
        </a>

       
            <button id="logoutBtn"
            class="transition-all duration-300 transform hover:scale-105 active:scale-95 text-white bg-red-500 hover:bg-red-600 px-4 py-1 rounded hidden md:block">
            <a href="userLogin.html">Logout</a>
          </button>
      </div>
      <button id="menuToggle" class="md:hidden text-white text-2xl focus:outline-none">
        ☰
      </button>
    </div>
  </nav>
  <!-- index Background Video -->
  <div class="relative w-full h-screen flex items-center justify-center text-white">
    <!-- Background Video -->
    <video autoplay loop muted playsinline class="absolute top-0 left-0 w-full h-full object-cover -z-10">
      <source src="/assets/Agri.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    <!-- Content -->
    <div class="relative z-10 text-center animate-fadeIn">
      <h1 class="text-4xl font-bold animate-zoomIn">Welcome to CropEase</h1>
      <h2 class="mt-2 text-4xl animate-slideInUp">Rent Top Quality equipments</h2>

      <!--REGION SELECT-->

      <div class="flex justify-center my-6">
        <div class="relative md:w-full max-w-md">
          <select id="regionSelect"
              class="transition-all duration-300 transform hover:scale-[1.01] appearance-none w-full max-w-md px-4 py-3 rounded-full border border-green-500 text-green-900 bg-white shadow-lg focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-green-400">
          </select>
          <!-- Down Arrow Icon -->
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4 text-green-500">
            <i class="fas fa-chevron-down"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Equipment Listing Container -->
  <div class="p-4 space-y-10 bg-gray-100" id="equipmentContainer">
    <!-- Machines will be injected here dynamically -->
  </div>
  <!-- REVIEWS -->
  <div class="p-4 bg-gray-200 bg-opacity-50">
    <h2 class="text-xl font-bold mb-4">Reviews</h2>
    <div class="flex justify-evenly grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2">
      <div class="bg-white p-4 shadow-md mx-1">
        <p class="italic">"Great service! Helped me a lot."</p>
        <p class="text-gray-500">
          <span style="color: #fdcc0d">⭐⭐⭐⭐⭐</span> - siranjeevi
        </p>
      </div>
      <div class="bg-white p-4 shadow-md mx-1">
        <p class="italic">"Easy to use. User friendly."</p>
        <p class="text-gray-500">
          <span style="color: #fdcc0d">⭐⭐⭐⭐⭐</span> - Habitha
        </p>
      </div>
      <div class="bg-white p-4 shadow-md mx-1">
        <p class="italic">"Machines comes on time."</p>
        <p class="text-gray-500">
          <span style="color: #fdcc0d">⭐⭐⭐⭐⭐ </span>- Mithra
        </p>
      </div>
      <div class="bg-white p-4 shadow-md mx-1">
        <p class="italic">"It comes on time.It will be very helpfull."</p>
        <p class="text-gray-500">
          <span style="color: #fdcc0d">⭐⭐⭐⭐⭐</span> - sanjay
        </p>
      </div>
      <div class="bg-white p-4 shadow-md mx-1">
        <p class="italic">"Best Service! Effectively Guide with team."</p>
        <p class="text-gray-500">
          <span style="color: #fdcc0d">⭐⭐⭐⭐⭐</span> - Balambiga
        </p>
      </div>
    </div>
  </div>

  <footer class="bg-green-600 p-4 text-[#E5E7EB] md:text-lg md:flex justify-between text-center">
    <h4>&copy; 2025 Crop Care . All right reserved</h4>
    <h4>
      Made with <i class="fa-solid fa-mug-hot" style="color: #ffd43b"></i> in
      chennai, India
    </h4>
  </footer>
  <script>
    

    const params = new URLSearchParams(window.location.search);
    const userId = params.get("userId");


fetch("http://localhost:8080/CropEase/allMachines")
  .then((res) => res.json())
  .then(machines => {
    const container = document.getElementById("equipmentContainer");
    container.innerHTML = ""; // clear old content

    // Group machines by business_name
    const groupedMachines = {};

    machines.forEach(machine => {
        if (!machine.registerSeller) return; // Skip if registerSeller is null

const businessName = machine.registerSeller.business_name;
if (!groupedMachines[businessName]) {
  groupedMachines[businessName] = [];
}
groupedMachines[businessName].push(machine);
    });

    const myOrderLinks = document.querySelectorAll('a[href*="userOrderPage.html"]');

myOrderLinks.forEach(link => {
  if (userId) {
    const url = new URL(link.href, window.location.origin);
    url.searchParams.set("userId", userId);
    link.href = url.toString();
  }
});

    // Loop through each group
    Object.entries(groupedMachines).forEach(([businessName, machineList]) => {
      // Create section title
      const section = document.createElement("div");
      section.className = "mb-8";

      const title = document.createElement("h2");
      title.className = "text-2xl font-bold text-green-700 mb-4";
      title.textContent = `Business: ${businessName}`;

      section.appendChild(title);

      // Create horizontal scroll container
      const scrollContainer = document.createElement("div");
      scrollContainer.className =
        "flex overflow-x-auto gap-4 pb-4 snap-x snap-mandatory";

        console.log("machineList ", machineList);
        

      machineList.forEach(machine => {


        const card = document.createElement("div");
        card.className =
          "bg-white rounded-lg shadow-md p-4 w-80 flex-shrink-0 snap-center";
        
          card.className =
  "bg-white rounded-lg shadow-md p-4 w-80 flex-shrink-0 snap-center transform transition-transform duration-300 hover:scale-105 animate-slideInUp";

  card.className = "bg-white rounded-lg shadow-md p-4 w-80 flex-shrink-0 snap-center transform transition-transform duration-300 hover:scale-105 animate-slideInUp";

  card.className = "bg-white rounded-lg shadow-md p-4 w-80 flex-shrink-0 snap-center transform transition-transform duration-300 hover:scale-105 animate-slideInUp border-2 border-green-500 animate-pulse-border";

        const imgSrc = `data:image/png;base64,${machine.image}`;

        card.innerHTML = `<a href="userMachineDetail.html?machineId=${machine.id}&userId=${userId}&sellerId=${machine.registerSeller.id}&region=${machine.regionName}">
          <img src="${imgSrc}" alt="${machine.name}" class="w-full h-48 object-cover rounded-md mb-2">
          <h3 class="text-xl font-semibold mb-1">${machine.title}</h3>
          <p class="text-gray-700"><strong>Name:</strong> ${machine.name}</p>
          <p class="text-gray-600"><strong>Details:</strong> ${machine.machine_details}</p>
          <p class="text-gray-600"><strong>Description:</strong> ${machine.description}</p>
          <p class="text-gray-800"><strong>Price:</strong> ₹${machine.price}</p>
          <p class="text-gray-500 mt-2 text-sm"><strong>Seller:</strong> ${machine.registerSeller.owner_name}</p>
        </a>`;

        scrollContainer.appendChild(card);
      });

      section.appendChild(scrollContainer);
      container.appendChild(section);
    });
  })
  .catch(err => console.error("Error loading machines:", err));

const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('error')) {
    alert("Invalid email or password");
  }
  
fetch("http://localhost:8080/regions")
      .then((res) => res.json())
      .then(regions => {

        const regionSelect = document.getElementById("regionSelect");

        regions.forEach(region => {

          const option = document.createElement("option");
          option.value = region.region_name;
          option.textContent = region.region_name;
          option.id = region.id;
          regionSelect.appendChild(option);
        });

        console.log(regions);

        
      })

    const authModal = document.getElementById("authModal");
    const loginTab = document.getElementById("loginTab");
    const signupTab = document.getElementById("signupTab");
    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    const logoutBtn = document.getElementById("logoutBtn");

    // Show/hide tabs
    loginTab.addEventListener("click", () => {
      loginForm.classList.remove("hidden");
      signupForm.classList.add("hidden");
      loginTab.classList.add("text-green-600", "border-green-600");
      signupTab.classList.remove("text-green-600", "border-green-600");
    });

    signupTab.addEventListener("click", () => {
      signupForm.classList.remove("hidden");
      loginForm.classList.add("hidden");
      signupTab.classList.add("text-green-600", "border-green-600");
      loginTab.classList.remove("text-green-600", "border-green-600");
    });

    // Simulate login/signup
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      localStorage.setItem("userLoggedIn", "true");
      authModal.classList.add("hidden");
    });

    signupForm.addEventListener("submit", (e) => {
      e.preventDefault();
      localStorage.setItem("userLoggedIn", "true");
      authModal.classList.add("hidden");
    });

    // Show popup on load if not logged in
    window.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("userLoggedIn") !== "true") {
        authModal.classList.remove("hidden");
      } else {
        authModal.classList.add("hidden");
      }
    });


    // Show logout only if logged in
    window.addEventListener("DOMContentLoaded", () => {
      if (localStorage.getItem("userLoggedIn") === "true") {
        logoutBtn.classList.remove("hidden");
      }
    });

    // Logout and show popup again
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("userLoggedIn");
     
      window.location.reload(); // reload to show modal again
      logoutBtn.classList.add("hidded");
      
    });


    const menuToggle = document.getElementById("menuToggle");
    const mobileMenu = document.getElementById("mobileMenu");
    const closeMenu = document.getElementById("closeMenu");
    const overlay = document.getElementById("overlay");

    // Open sidebar
    menuToggle.addEventListener("click", () => {
      mobileMenu.classList.remove("-translate-x-full");
      mobileMenu.classList.add("translate-x-0");
      overlay.classList.remove("hidden");
    });

    // Close sidebar
    function closeSidebar() {
      mobileMenu.classList.remove("translate-x-0");
      mobileMenu.classList.add("-translate-x-full");
      overlay.classList.add("hidden");
    }

    closeMenu.addEventListener("click", closeSidebar);

    // Close on click outside sidebar
    overlay.addEventListener("click", closeSidebar);
  </script>
</body>

</html>